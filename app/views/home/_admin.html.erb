<html>
    <head>
        <%= javascript_include_tag 'owners' %>
    </head>
    <body>
        <%= render partial: "modal"%>
        <div class="container">
            <div class="dashboard">
                <h1>Dashboard</h1>
                <p><%= Date.today.strftime("%d-%m-%Y") %></p>
            </div>
            <div class="search">
            </div>
            <div class="pfp_image">
                <%= image_tag("pfp.webp",class:"image")%>
            </div>
            <div class="name">
                    <span><%= current_user.admin.name %></span>
            </div>
        </div>
        <div class="action_buttons">
            <button type="button" id="add_owner_input" class="btn" data-bs-toggle="modal" data-bs-target="#exampleModal">Add Owner</button>
            <button type="button" id="myInput1" class="btn" data-bs-toggle="modal" data-bs-target="#exampleModal">Edit Owner</button>
        </div>
        <div class="container_grid text-center">
            <div class="row">
                <div class="col">
                    <span id="deactive_owners_count">
                    <h4>Deactive Owners</h4>
                    <br />
                    <h6><%= @deactive_count %></h6>
                    </span>
                    <%= link_to 'Activate', owners_path,method: :get%>
                </div>
                <div class="col">
                    <h4>Active PG Owners</h4>
                    <br />
                    <h6><%= @active_count %></h6>

                    <%= link_to 'De-Activate', owners_path, method: :get%>
                </div>
                <div class="col">
                    <h4>Total PG Owners</h4>
                    <br />
                    <h6>The PG Owners created by you:<br /><br /><%= current_user.admin.owners.count%></h6>
                    <%= link_to 'View All', owners_path, method: :get%>
                </div>
                <div class="col">
                    <h4>Total PG's</h4>
                    <br />
                    <h6>The total number of PGs are:</h6>
                    <%count = 0%>
                    <% current_user.admin.owners.each do |owner| %>
                        <% if owner.status=="active" %>
                            <%owner.pg_buildings.each do |building|%>
                                <%count=count+1%>
                            <%end%>
                        <%end%>
                    <%end%>
                    <br />
                    <%= count %>
                    <br />
                    <%= link_to 'View All'%>
                </div>
            </div>
        </div>
        <div class="grid-container">
            <%@pg_buildings.each do |building|%>
                <%if (building.owner.admin_id == current_user.admin.id)%>
                        <div class="item", id="building">
                            <% if building.image.present? %>
                                <%= image_tag building.image, style: "height:120px;width:120px;" %>
                            <% else %>
                                <p>No image available</p>
                            <% end %>
                            <p><%=building.name%></p>
                            <p><%=building.phone%></p>
                            <p><%=building.email%></p>
                            <p><%=building.address%></p>
                            <p><%= building.owner.name%>
                        </div>
                <%end%>
            <%end%>
        </div>
    </body>
    <script>
        $('#add_owner_input').on('click', function(){
            const AddOwnerInput = document.getElementById('add_owner_input');
            const myModal = document.getElementById('myModal');
            

            myModal.addEventListener('shown.bs.modal', () => {
                AddOwnerInput.focus();
            });
      });
    </script>
</html>